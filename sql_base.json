{
  "generales": [
    {
      "pregunta": "¿Cuántos cursos existen?",
      "sql": "SELECT COUNT(*) FROM {PREFIX}course;"
    },
    {
      "pregunta": "¿Cuántos estudiantes hay en total?",
      "sql": "SELECT COUNT(DISTINCT u.id) FROM {PREFIX}user u JOIN {PREFIX}role_assignments ra ON ra.userid = u.id WHERE ra.roleid = 5 AND u.deleted = 0;"
    },
    {
      "pregunta": "¿Cuál es el curso con mayor cantidad de estudiantes?",
      "sql": "SELECT c.fullname, COUNT(DISTINCT u.id) AS total FROM {PREFIX}course c JOIN {PREFIX}enrol e ON c.id = e.courseid JOIN {PREFIX}user_enrolments ue ON ue.enrolid = e.id JOIN {PREFIX}user u ON u.id = ue.userid JOIN {PREFIX}role_assignments ra ON ra.userid = u.id WHERE ra.roleid = 5 GROUP BY c.fullname ORDER BY total DESC LIMIT 1;"
    },
    {
      "pregunta": "¿Cuáles son los cursos más activos por cantidad de mensajes en foros?",
      "sql": "SELECT c.fullname, COUNT(fp.id) AS mensajes FROM {PREFIX}forum_posts fp JOIN {PREFIX}forum_discussions fd ON fp.discussion = fd.id JOIN {PREFIX}forum f ON fd.forum = f.id JOIN {PREFIX}course c ON f.course = c.id GROUP BY c.fullname ORDER BY mensajes DESC LIMIT 5;"
    },
    {
      "pregunta": "¿Qué estudiantes están matriculados en más de 3 cursos?",
      "sql": "SELECT u.id, u.firstname, u.lastname, COUNT(DISTINCT c.id) AS cursos FROM {PREFIX}user u JOIN {PREFIX}role_assignments ra ON ra.userid = u.id AND ra.roleid = 5 JOIN {PREFIX}user_enrolments ue ON ue.userid = u.id JOIN {PREFIX}enrol e ON ue.enrolid = e.id JOIN {PREFIX}course c ON e.courseid = c.id GROUP BY u.id HAVING cursos > 3;"
    },
    {
      "pregunta": "¿Cuáles son los cursos más pesados?",
      "sql": "SELECT c.fullname, ROUND(SUM(f.filesize) / 1024 / 1024, 2) AS tamaño_mb FROM {PREFIX}files f JOIN {PREFIX}context ctx ON ctx.id = f.contextid JOIN {PREFIX}course c ON c.id = ctx.instanceid WHERE f.component = 'course' AND f.filesize > 0 GROUP BY c.fullname ORDER BY tamaño_mb DESC LIMIT 5;"
    },
    {
      "pregunta": "¿Cuál es el momento de mayor concurrencia de la plataforma?",
      "sql": "SELECT HOUR(FROM_UNIXTIME(timecreated)) AS hora, COUNT(*) AS accesos FROM {PREFIX}logstore_standard_log GROUP BY hora ORDER BY accesos DESC LIMIT 1;"
    }
  ],
  "generales_ia": [],
  "por_curso": [
    {
      "pregunta": "¿Cuántos estudiantes hay en este curso?",
      "sql": "SELECT COUNT(DISTINCT u.id) FROM {PREFIX}user u JOIN {PREFIX}user_enrolments ue ON ue.userid = u.id JOIN {PREFIX}enrol e ON e.id = ue.enrolid JOIN {PREFIX}course c ON c.id = e.courseid JOIN {PREFIX}context ctx ON ctx.instanceid = c.id AND ctx.contextlevel = 50 JOIN {PREFIX}role_assignments ra ON ra.userid = u.id AND ra.contextid = ctx.id WHERE c.fullname = '__CURSO__' AND ra.roleid = 5;"
    },
    {
      "pregunta": "Mostrame la lista de estudiantes ordenada por promedio.",
      "sql": "SELECT u.firstname, u.lastname, ROUND(AVG(gg.finalgrade), 2) AS promedio FROM {PREFIX}user u JOIN {PREFIX}user_enrolments ue ON ue.userid = u.id JOIN {PREFIX}enrol e ON e.id = ue.enrolid JOIN {PREFIX}course c ON e.courseid = c.id JOIN {PREFIX}grade_items gi ON gi.courseid = c.id JOIN {PREFIX}grade_grades gg ON gg.userid = u.id AND gg.itemid = gi.id JOIN {PREFIX}context ctx ON ctx.instanceid = c.id AND ctx.contextlevel = 50 JOIN {PREFIX}role_assignments ra ON ra.userid = u.id AND ra.contextid = ctx.id WHERE c.fullname = '__CURSO__' AND ra.roleid = 5 GROUP BY u.id ORDER BY promedio DESC;"
    },
    {
      "pregunta": "¿Cuál es la nota promedio de los estudiantes en este curso?",
      "sql": "SELECT ROUND(AVG(gg.finalgrade),2) AS promedio FROM {PREFIX}grade_grades gg JOIN {PREFIX}grade_items gi ON gg.itemid = gi.id JOIN {PREFIX}course c ON gi.courseid = c.id WHERE c.fullname = '__CURSO__';"
    },
    {
      "pregunta": "¿Qué estudiantes aún no han publicado en ningún foro del curso?",
      "sql": "SELECT DISTINCT u.id, u.firstname, u.lastname FROM {PREFIX}user u JOIN {PREFIX}user_enrolments ue ON ue.userid = u.id JOIN {PREFIX}enrol e ON ue.enrolid = e.id JOIN {PREFIX}course c ON e.courseid = c.id JOIN {PREFIX}context ctx ON ctx.instanceid = c.id AND ctx.contextlevel = 50 JOIN {PREFIX}role_assignments ra ON ra.userid = u.id AND ra.contextid = ctx.id WHERE c.fullname = '__CURSO__' AND ra.roleid = 5 AND u.id NOT IN (SELECT DISTINCT fp.userid FROM {PREFIX}forum_posts fp JOIN {PREFIX}forum_discussions fd ON fp.discussion = fd.id JOIN {PREFIX}forum f ON fd.forum = f.id WHERE f.course = c.id);"
    },
    {
      "pregunta": "¿Qué porcentaje de avance tiene el curso?",
      "sql": "SELECT CONCAT(ROUND(SUM(CASE WHEN cm.completion = 1 THEN 1 ELSE 0 END) / COUNT(*) * 100, 2), '%') AS avance FROM {PREFIX}course_modules cm JOIN {PREFIX}course c ON cm.course = c.id WHERE c.fullname = '__CURSO__';"
    },
    {
      "pregunta": "¿Cuándo se conectó cada estudiante por última vez?",
      "sql": "SELECT u.firstname, u.lastname, MAX(l.timecreated) AS ultima_conexion FROM {PREFIX}user u JOIN {PREFIX}user_enrolments ue ON ue.userid = u.id JOIN {PREFIX}enrol e ON e.id = ue.enrolid JOIN {PREFIX}course c ON c.id = e.courseid JOIN {PREFIX}context ctx ON ctx.instanceid = c.id AND ctx.contextlevel = 50 JOIN {PREFIX}role_assignments ra ON ra.userid = u.id AND ra.contextid = ctx.id LEFT JOIN {PREFIX}logstore_standard_log l ON l.userid = u.id AND l.courseid = c.id WHERE c.fullname = '__CURSO__' AND ra.roleid = 5 GROUP BY u.id;"
    },
    {
      "pregunta": "¿Qué estudiantes llevan más de 2 semanas sin conectarse?",
      "sql": "SELECT u.firstname, u.lastname, MAX(l.timecreated) AS ultima_conexion FROM {PREFIX}user u JOIN {PREFIX}user_enrolments ue ON ue.userid = u.id JOIN {PREFIX}enrol e ON ue.enrolid = e.id JOIN {PREFIX}course c ON c.id = e.courseid JOIN {PREFIX}context ctx ON ctx.instanceid = c.id AND ctx.contextlevel = 50 JOIN {PREFIX}role_assignments ra ON ra.userid = u.id AND ra.contextid = ctx.id LEFT JOIN {PREFIX}logstore_standard_log l ON l.userid = u.id AND l.courseid = c.id WHERE c.fullname = '__CURSO__' AND ra.roleid = 5 GROUP BY u.id HAVING MAX(l.timecreated) < UNIX_TIMESTAMP(DATE_SUB(NOW(), INTERVAL 14 DAY)) OR MAX(l.timecreated) IS NULL;"
    },
    {
      "pregunta": "¿Cuándo se conectó el docente por última vez?",
      "sql": "SELECT u.firstname, u.lastname, MAX(l.timecreated) AS ultima_conexion FROM {PREFIX}user u JOIN {PREFIX}role_assignments ra ON ra.userid = u.id JOIN {PREFIX}context ctx ON ctx.id = ra.contextid JOIN {PREFIX}course c ON ctx.instanceid = c.id JOIN {PREFIX}logstore_standard_log l ON l.userid = u.id AND l.courseid = c.id WHERE c.fullname = '__CURSO__' AND ra.roleid = 3 GROUP BY u.id;"
    },
    {
      "pregunta": "¿Qué alumnos son los que más veces entraron al campus?",
      "sql": "SELECT u.firstname, u.lastname, COUNT(*) AS accesos FROM {PREFIX}logstore_standard_log l JOIN {PREFIX}user u ON u.id = l.userid JOIN {PREFIX}course c ON l.courseid = c.id JOIN {PREFIX}user_enrolments ue ON ue.userid = u.id JOIN {PREFIX}enrol e ON e.id = ue.enrolid JOIN {PREFIX}context ctx ON ctx.instanceid = c.id AND ctx.contextlevel = 50 JOIN {PREFIX}role_assignments ra ON ra.userid = u.id AND ra.contextid = ctx.id WHERE c.fullname = '__CURSO__' AND ra.roleid = 5 GROUP BY u.id ORDER BY accesos DESC LIMIT 10;"
    },
    {
      "pregunta": "¿En qué horarios se conectan las personas con mayor frecuencia?",
      "sql": "SELECT HOUR(FROM_UNIXTIME(l.timecreated)) AS hora, COUNT(*) AS accesos FROM {PREFIX}logstore_standard_log l JOIN {PREFIX}course c ON c.id = l.courseid WHERE c.fullname = '__CURSO__' GROUP BY hora ORDER BY accesos DESC;"
    }
  ],
  "por_curso_ia": [
    {
      "pregunta": "¿Qué expectativas tienen del curso según el foro de presentación? (IA)",
      "descripcion": "Extrae los mensajes del foro 'Presentación' del curso y analiza con IA para detectar expresiones sobre expectativas.",
      "sql": "SELECT u.firstname, u.lastname, fp.message FROM {PREFIX}forum_posts fp JOIN {PREFIX}forum_discussions fd ON fp.discussion = fd.id JOIN {PREFIX}forum f ON fd.forum = f.id JOIN {PREFIX}course c ON f.course = c.id JOIN {PREFIX}user u ON fp.userid = u.id WHERE c.fullname = '__CURSO__' AND LOWER(f.name) LIKE '%presentacion%';"
    },
    {
      "pregunta": "¿Detectás prácticas poco éticas en este curso? (IA)",
      "descripcion": "Analizá los mensajes y detectá si hay evidencia de conductas poco éticas como compartir exámenes, copiar respuestas, pedir material prohibido, hacer trampa o utilizar lenguaje ofensivo o discriminatorio. Indicá cuál es el mensaje comprometedor y por qué.",
      "sql": "SELECT u.firstname, u.lastname, fp.message, FROM_UNIXTIME(fp.created) as fecha FROM {PREFIX}forum_posts fp JOIN {PREFIX}forum_discussions fd ON fp.discussion = fd.id JOIN {PREFIX}forum f ON fd.forum = f.id JOIN {PREFIX}course c ON f.course = c.id JOIN {PREFIX}user u ON fp.userid = u.id WHERE c.fullname = '__CURSO__';"
    },
    {
      "pregunta": "¿Qué mensajes del foro en este curso aún no recibieron ninguna respuesta útil? (IA)",
      "descripcion": "Analizá los mensajes del foro en este curso y detectá qué preguntas no recibieron ninguna respuesta útil. Una respuesta útil debe intentar aclarar, resolver o aportar información, no simplemente repetir la duda o decir 'yo también'. Devolvé una lista con las preguntas sin respuesta real.",
      "sql": "SELECT d.id AS discusion_id, u.firstname, u.lastname, fp.message, fp.parent FROM {PREFIX}forum_posts fp JOIN {PREFIX}forum_discussions d ON fp.discussion = d.id JOIN {PREFIX}forum f ON d.forum = f.id JOIN {PREFIX}course c ON f.course = c.id JOIN {PREFIX}user u ON fp.userid = u.id WHERE c.fullname = '__CURSO__' ORDER BY d.id, fp.created;"
    }
  ],
  "invisibles": [
    {
      "pregunta": "¿Cuál es la cantidad total de cursos creados en la plataforma?",
      "sql": "SELECT COUNT(*) FROM {PREFIX}course;",
      "visible": false
    },
    {
      "pregunta": "¿Cuántos estudiantes tienen nota mayor a 7 en el curso?",
      "sql": "SELECT u.firstname, u.lastname, g.finalgrade FROM {PREFIX}user u JOIN {PREFIX}grade_grades g ON g.userid = u.id JOIN {PREFIX}grade_items gi ON gi.id = g.itemid JOIN {PREFIX}course c ON gi.courseid = c.id JOIN {PREFIX}context ctx ON ctx.instanceid = c.id AND ctx.contextlevel = 50 JOIN {PREFIX}role_assignments ra ON ra.userid = u.id AND ra.contextid = ctx.id WHERE c.fullname = '__CURSO__' AND g.finalgrade > 7 AND ra.roleid = 5;",
      "visible": false
    },
    {
      "pregunta": "¿Qué estudiantes nunca ingresaron al curso?",
      "sql": "SELECT u.id, u.firstname, u.lastname FROM {PREFIX}user u JOIN {PREFIX}user_enrolments ue ON ue.userid = u.id JOIN {PREFIX}enrol e ON e.id = ue.enrolid JOIN {PREFIX}course c ON c.id = e.courseid JOIN {PREFIX}context ctx ON ctx.instanceid = c.id AND ctx.contextlevel = 50 JOIN {PREFIX}role_assignments ra ON ra.userid = u.id AND ra.contextid = ctx.id WHERE c.fullname = '__CURSO__' AND ra.roleid = 5 AND u.id NOT IN (SELECT DISTINCT userid FROM {PREFIX}logstore_standard_log WHERE courseid = c.id);",
      "visible": false
    },
    {
      "pregunta": "¿Cuántos mensajes se publicaron en el foro 'Presentación'?",
      "sql": "SELECT COUNT(fp.id) FROM {PREFIX}forum_posts fp JOIN {PREFIX}forum_discussions fd ON fp.discussion = fd.id JOIN {PREFIX}forum f ON fd.forum = f.id JOIN {PREFIX}course c ON f.course = c.id WHERE c.fullname = '__CURSO__' AND f.name = 'Presentación';",
      "visible": false
    },
    {
      "pregunta": "¿Qué estudiantes obtuvieron exactamente 10 como nota final?",
      "sql": "SELECT u.firstname, u.lastname FROM {PREFIX}user u JOIN {PREFIX}grade_grades gg ON gg.userid = u.id JOIN {PREFIX}grade_items gi ON gg.itemid = gi.id JOIN {PREFIX}course c ON gi.courseid = c.id JOIN {PREFIX}context ctx ON ctx.instanceid = c.id AND ctx.contextlevel = 50 JOIN {PREFIX}role_assignments ra ON ra.userid = u.id AND ra.contextid = ctx.id WHERE c.fullname = '__CURSO__' AND gg.finalgrade = 10 AND ra.roleid = 5;",
      "visible": false
    },
    {
      "pregunta": "¿Cuántos accesos se registraron al curso?",
      "sql": "SELECT COUNT(*) FROM {PREFIX}logstore_standard_log l JOIN {PREFIX}course c ON l.courseid = c.id WHERE c.fullname = '__CURSO__';",
      "visible": false
    },
    {
      "pregunta": "¿Qué mensajes pueden reflejar prácticas poco éticas en los foros?",
      "sql": "SELECT u.firstname, u.lastname, fp.message, FROM_UNIXTIME(fp.created) AS fecha FROM {PREFIX}forum_posts fp JOIN {PREFIX}user u ON u.id = fp.userid WHERE fp.created >= UNIX_TIMESTAMP(DATE_SUB(NOW(), INTERVAL 90 DAY));",
      "visible": false
    },
    {
      "pregunta": "¿Cuántos estudiantes aprobaron con nota mayor a 6?",
      "sql": "SELECT COUNT(DISTINCT u.id) FROM {PREFIX}user u JOIN {PREFIX}grade_grades gg ON gg.userid = u.id JOIN {PREFIX}grade_items gi ON gg.itemid = gi.id JOIN {PREFIX}course c ON gi.courseid = c.id JOIN {PREFIX}context ctx ON ctx.instanceid = c.id AND ctx.contextlevel = 50 JOIN {PREFIX}role_assignments ra ON ra.userid = u.id AND ra.contextid = ctx.id WHERE c.fullname = '__CURSO__' AND gg.finalgrade > 6 AND ra.roleid = 5;",
      "visible": false
    },
    {
      "pregunta": "¿Qué cursos tienen más de 50 estudiantes matriculados?",
      "sql": "SELECT c.fullname, COUNT(DISTINCT u.id) AS cantidad FROM {PREFIX}course c JOIN {PREFIX}enrol e ON c.id = e.courseid JOIN {PREFIX}user_enrolments ue ON ue.enrolid = e.id JOIN {PREFIX}user u ON u.id = ue.userid JOIN {PREFIX}context ctx ON ctx.instanceid = c.id AND ctx.contextlevel = 50 JOIN {PREFIX}role_assignments ra ON ra.userid = u.id AND ra.contextid = ctx.id WHERE ra.roleid = 5 GROUP BY c.fullname HAVING cantidad > 50;",
      "visible": false
    },
    {
      "pregunta": "¿Qué recursos están disponibles y qué tipo son?",
      "sql": "SELECT cm.id, m.name AS tipo_recurso FROM {PREFIX}course_modules cm JOIN {PREFIX}modules m ON cm.module = m.id JOIN {PREFIX}course c ON cm.course = c.id WHERE c.fullname = '__CURSO__';",
      "visible": false
    },
    {
      "pregunta": "¿Qué estudiantes accedieron más veces al curso?",
      "sql": "SELECT u.firstname, u.lastname, COUNT(*) AS accesos FROM {PREFIX}logstore_standard_log l JOIN {PREFIX}user u ON l.userid = u.id JOIN {PREFIX}course c ON l.courseid = c.id JOIN {PREFIX}context ctx ON ctx.instanceid = c.id AND ctx.contextlevel = 50 JOIN {PREFIX}role_assignments ra ON ra.userid = u.id AND ra.contextid = ctx.id WHERE c.fullname = '__CURSO__' AND ra.roleid = 5 GROUP BY u.id ORDER BY accesos DESC LIMIT 10;",
      "visible": false
    },
    {
      "pregunta": "¿Qué mensajes escribió el estudiante llamado Alumno3?",
      "sql": "SELECT u.firstname, u.lastname, fp.message FROM {PREFIX}user u JOIN {PREFIX}forum_posts fp ON u.id = fp.userid JOIN {PREFIX}forum_discussions fd ON fp.discussion = fd.id JOIN {PREFIX}forum f ON fd.forum = f.id JOIN {PREFIX}course c ON f.course = c.id WHERE c.fullname = '__CURSO__' AND u.firstname = 'Alumno3';",
      "visible": false
    }
  ]
}